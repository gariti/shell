import "modules"
import "modules/background"
import "modules/bar" as BarModule
import "modules/bar/popouts" as BarPopouts
import "widgets"
import "services-niri" as Services
import "config"
import "utils"
import Quickshell
import Quickshell.Wayland
import QtQuick

ShellRoot {
    // Background wallpaper
    Background {}
    
    // Main bar panel for Niri
    Variants {
        model: Quickshell.screens

        PanelWindow {
            required property ShellScreen modelData
            
            screen: modelData
            anchors {
                left: true
                top: true
                bottom: true
            }
            
            WlrLayershell.namespace: "caelestia-shell"
            WlrLayershell.layer: WlrLayer.Top
            WlrLayershell.exclusionMode: ExclusionMode.Normal
            
            color: "transparent"
            
            // Use the actual caelestia bar but create popouts instance first
            BarPopouts.Wrapper {
                id: popouts
                screen: modelData
            }
            
            BarModule.Bar {
                id: bar
                screen: modelData
                popouts: popouts
                anchors.fill: parent
            }
        }
    }
    
    // Drawers (for expanded functionality)
    Drawers {}
}
